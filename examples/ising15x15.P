:- import concat_atom/2 from string.

type(bool, [t, f]).
outcomes(edge, [bool, bool]).
set_sw(edge, [0.49, 0.01, 0.01, 0.49]).

row_edges(1, N1, N2, N3, N4, N5, N6, N7, N8, N9, N10,
	  N11, N12, N13, N14, N15) :-
    msw(edge, e_01_01_01_02, [N1, N2]),
    msw(edge, e_01_02_01_03, [N2S, N3]),
    msw(edge, e_01_03_01_04, [N3S, N4]),
    msw(edge, e_01_04_01_05, [N4S, N5]),
    msw(edge, e_01_05_01_06, [N5S, N6]),
    msw(edge, e_01_06_01_07, [N6S, N7]),
    msw(edge, e_01_07_01_08, [N7S, N8]),
    msw(edge, e_01_08_01_09, [N8S, N9]),
    msw(edge, e_01_09_01_10, [N9S, N10]),
    msw(edge, e_01_10_01_11, [N10S, N11]),
    msw(edge, e_01_11_01_12, [N11S, N12]),
    msw(edge, e_01_12_01_13, [N12S, N13]),
    msw(edge, e_01_13_01_14, [N13S, N14]),
    msw(edge, e_01_14_01_15, [N14S, N15]),
    {N2 = N2S},
    {N3 = N3S},
    {N4 = N4S},
    {N5 = N5S},
    {N6 = N6S},
    {N7 = N7S},
    {N8 = N8S},
    {N9 = N9S},
    {N10 = N10S},
    {N11 = N11S},
    {N12 = N12S},
    {N13 = N13S},
    {N14 = N14S}.

test1(N) :- row_edges(N, N1, N2, N3, N4, N5, N6, N7, N8, N9, N10, N11, N12, N13, N14, N15).

test2(R) :-
    R1 is R - 1,
    column_edges(R1, R, N1, N2, N3, N4, N5, N6, N7, N8, N9, N10, N11, N12, N13, N14, N15).

row_edges(Rin, N1, N2, N3, N4, N5, N6, N7, N8, N9, N10,
	  N11, N12, N13, N14, N15) :-
    1 < R, R =< 15,
    R1 is R - 1,
    column_edges(R1, R, M1, M2, M3, M4, M5, M6, M7, M8, M9, M10,
		 M11, M12, M13, M14, M15),

    fmt_write_string(R, '%02d', Rin),
    concat_atom([e,'_',R,'_','01','_',R,'_','02'], E1),
    concat_atom([e,'_',R,'_','02','_',R,'_','03'], E2),    
    concat_atom([e,'_',R,'_','03','_',R,'_','04'], E3),    
    concat_atom([e,'_',R,'_','04','_',R,'_','05'], E4),    
    concat_atom([e,'_',R,'_','05','_',R,'_','06'], E5),
    concat_atom([e,'_',R,'_','06','_',R,'_','07'], E6),    
    concat_atom([e,'_',R,'_','07','_',R,'_','08'], E7),    
    concat_atom([e,'_',R,'_','08','_',R,'_','09'], E8),    
    concat_atom([e,'_',R,'_','09','_',R,'_','10'], E9),
    concat_atom([e,'_',R,'_','10','_',R,'_','11'], E10),    
    concat_atom([e,'_',R,'_','11','_',R,'_','12'], E11),    
    concat_atom([e,'_',R,'_','12','_',R,'_','13'], E12),    
    concat_atom([e,'_',R,'_','13','_',R,'_','14'], E13),    
    concat_atom([e,'_',R,'_','14','_',R,'_','15'], E14),    

    msw(edge, E1, [N1, N2]),
    msw(edge, E2, [N2S, N3]),
    msw(edge, E3, [N3S, N4]),
    msw(edge, E4, [N4S, N5]),
    msw(edge, E5, [N5S, N6]),
    msw(edge, E6, [N6S, N7]),
    msw(edge, E7, [N7S, N8]),
    msw(edge, E8, [N8S, N9]),
    msw(edge, E9, [N9S, N10]),
    msw(edge, E10, [N10S, N11]),
    msw(edge, E11, [N11S, N12]),
    msw(edge, E12, [N12S, N13]),
    msw(edge, E13, [N13S, N14]),
    msw(edge, E14, [N14S, N15]),

    {N2 = N2S},
    {N3 = N3S},
    {N4 = N4S},
    {N5 = N5S},
    {N6 = N6S},
    {N7 = N7S},
    {N8 = N8S},
    {N9 = N9S},
    {N10 = N10S},
    {N11 = N11S},
    {N12 = N12S},
    {N13 = N13S},
    {N14 = N14S},

    {M1 = N1},
    {M2 = N2},
    {M3 = N3},
    {M4 = N4},
    {M5 = N5},
    {M6 = N6},
    {M7 = N7},
    {M8 = N8},
    {M9 = N9},
    {M10 = N10},
    {M11 = N11},
    {M12 = N12},
    {M13 = N13},
    {M14 = N14},
    {M15 = N15}.

column_edges(R1in, R2in, M1, M2, M3, M4, M5, M6, M7, M8, M9, M10,
	     M11, M12, M13, M14, M15) :-
    row_edges(R1, N1, N2, N3, N4, N5, N6, N7, N8, N9, N10,
	      N11, N12, N13, N14, N15),

    fmt_write_string(R1, '%02d', R1in),
    fmt_write_string(R2, '%02d', R2in),    
    concat_atom([e,'_',R1,'_','01','_',R2,'_','01'], E1),
    concat_atom([e,'_',R1,'_','02','_',R2,'_','02'], E2),
    concat_atom([e,'_',R1,'_','03','_',R2,'_','03'], E3),
    concat_atom([e,'_',R1,'_','04','_',R2,'_','04'], E4),
    concat_atom([e,'_',R1,'_','05','_',R2,'_','05'], E5),
    concat_atom([e,'_',R1,'_','06','_',R2,'_','06'], E6),
    concat_atom([e,'_',R1,'_','07','_',R2,'_','07'], E7),
    concat_atom([e,'_',R1,'_','08','_',R2,'_','08'], E8),
    concat_atom([e,'_',R1,'_','09','_',R2,'_','09'], E9),
    concat_atom([e,'_',R1,'_','10','_',R2,'_','10'], E10),
    concat_atom([e,'_',R1,'_','11','_',R2,'_','11'], E11),
    concat_atom([e,'_',R1,'_','12','_',R2,'_','12'], E12),
    concat_atom([e,'_',R1,'_','13','_',R2,'_','13'], E13),
    concat_atom([e,'_',R1,'_','14','_',R2,'_','14'], E14),
    concat_atom([e,'_',R1,'_','15','_',R2,'_','15'], E15),
    
    msw(edge, E1, [M1S, M1]),
    msw(edge, E2, [M2S, M2]),
    msw(edge, E3, [M3S, M3]),
    msw(edge, E4, [M4S, M4]),
    msw(edge, E5, [M5S, M5]),
    msw(edge, E6, [M6S, M6]),
    msw(edge, E7, [M7S, M7]),
    msw(edge, E8, [M8S, M8]),
    msw(edge, E9, [M9S, M9]),
    msw(edge, E10, [M10S, M10]),
    msw(edge, E11, [M11S, M11]),
    msw(edge, E12, [M12S, M12]),
    msw(edge, E13, [M13S, M13]),
    msw(edge, E14, [M14S, M14]),
    msw(edge, E15, [M15S, M15]),

    {M1S = N1},
    {M2S = N2},
    {M3S = N3},
    {M4S = N4},
    {M5S = N5},
    {M6S = N6},
    {M7S = N7},
    {M8S = N8},
    {M9S = N9},
    {M10S = N10},
    {M11S = N11},
    {M12S = N12},
    {M13S = N13},
    {M14S = N14},
    {M15S = N15}.    
    
    
evidence :-
    row_edges(15, N1, N2, N3, N4, N5, N6, N7, N8, N9, N10,
	      N11, N12, N13, N14, N15).

query :-
    query_row(15),
    query_col(15).

query_row(0).
query_row(Nin) :-
    N > 0,

    fmt_write_string(N, '%02d', Nin),    
    concat_atom([e,'_',N,'_','01','_',N,'_','02'], E1),
    concat_atom([e,'_',N,'_','02','_',N,'_','03'], E2),    
    concat_atom([e,'_',N,'_','03','_',N,'_','04'], E3),    
    concat_atom([e,'_',N,'_','04','_',N,'_','05'], E4),    
    concat_atom([e,'_',N,'_','05','_',N,'_','06'], E5),
    concat_atom([e,'_',N,'_','06','_',N,'_','07'], E6),    
    concat_atom([e,'_',N,'_','07','_',N,'_','08'], E7),    
    concat_atom([e,'_',N,'_','08','_',N,'_','09'], E8),    
    concat_atom([e,'_',N,'_','09','_',N,'_','10'], E9),
    concat_atom([e,'_',N,'_','10','_',N,'_','11'], E10),    
    concat_atom([e,'_',N,'_','11','_',N,'_','12'], E11),    
    concat_atom([e,'_',N,'_','12','_',N,'_','13'], E12),    
    concat_atom([e,'_',N,'_','13','_',N,'_','14'], E13),    
    concat_atom([e,'_',N,'_','14','_',N,'_','15'], E14),    

    msw(edge, E1, [N1, N2]),
    msw(edge, E2, [N2S, N3]),
    msw(edge, E3, [N3S, N4]),
    msw(edge, E4, [N4S, N5]),
    msw(edge, E5, [N5S, N6]),
    msw(edge, E6, [N6S, N7]),
    msw(edge, E7, [N7S, N8]),
    msw(edge, E8, [N8S, N9]),
    msw(edge, E9, [N9S, N10]),
    msw(edge, E10, [N10S, N11]),
    msw(edge, E11, [N11S, N12]),
    msw(edge, E12, [N12S, N13]),
    msw(edge, E13, [N13S, N14]),
    msw(edge, E14, [N14S, N15]),
    

    {N1 = t},
    {N2 = t},
    {N2S = t},
    {N3 = t},
    {N3S = t},
    {N4 = t},
    {N4S = t},
    {N5 = t},
    {N5S = t},
    {N6 = t},
    {N6S = t},
    {N7 = t},
    {N7S = t},
    {N8 = t},
    {N8S = t},
    {N9 = t},
    {N9S = t},
    {N10 = t},
    {N10S = t},
    {N11 = t},
    {N11S = t},
    {N12 = t},
    {N12S = t},
    {N13 = t},
    {N13S = t},
    {N14 = t},
    {N14S = t},
    {N15 = t},

    N1 is N-1,
    query_row(N1).

query_col(1).
query_col(N2) :-
    N2 > 1,
    N1 is N2 - 1,

    concat_atom([e,'_',N1,'_',01,'_',N2,01], E1),
    concat_atom([e,'_',N1,'_',02,'_',N2,02], E2),
    concat_atom([e,'_',N1,'_',03,'_',N2,03], E3),
    concat_atom([e,'_',N1,'_',04,'_',N2,04], E4),
    concat_atom([e,'_',N1,'_',05,'_',N2,05], E5),
    concat_atom([e,'_',N1,'_',06,'_',N2,06], E6),
    concat_atom([e,'_',N1,'_',07,'_',N2,07], E7),
    concat_atom([e,'_',N1,'_',08,'_',N2,08], E8),
    concat_atom([e,'_',N1,'_',09,'_',N2,09], E9),
    concat_atom([e,'_',N1,'_',10,'_',N2,10], E10),
    concat_atom([e,'_',N1,'_',11,'_',N2,11], E11),
    concat_atom([e,'_',N1,'_',12,'_',N2,12], E12),
    concat_atom([e,'_',N1,'_',13,'_',N2,13], E13),
    concat_atom([e,'_',N1,'_',14,'_',N2,14], E14),
    concat_atom([e,'_',N1,'_',15,'_',N2,15], E15),
    
    msw(edge, E1, [M1S, M1]),
    msw(edge, E2, [M2S, M2]),
    msw(edge, E3, [M3S, M3]),
    msw(edge, E4, [M4S, M4]),
    msw(edge, E5, [M5S, M5]),
    msw(edge, E6, [M6S, M6]),
    msw(edge, E7, [M7S, M7]),
    msw(edge, E8, [M8S, M8]),
    msw(edge, E9, [M9S, M9]),
    msw(edge, E10, [M10S, M10]),
    msw(edge, E11, [M11S, M11]),
    msw(edge, E12, [M12S, M12]),
    msw(edge, E13, [M13S, M13]),
    msw(edge, E14, [M14S, M14]),
    msw(edge, E15, [M15S, M15]),

    {M1S = t}, {M1 = t},
    {M2S = t}, {M2 = t},
    {M3S = t}, {M3 = t},
    {M4S = t}, {M4 = t},
    {M5S = t}, {M5 = t},
    {M6S = t}, {M6 = t},
    {M7S = t}, {M7 = t},
    {M8S = t}, {M8 = t},
    {M9S = t}, {M9 = t},
    {M10S = t}, {M10 = t},
    {M11S = t}, {M11 = t},
    {M12S = t}, {M12 = t},
    {M13S = t}, {M13 = t},
    {M14S = t}, {M14 = t},
    {M15S = t}, {M15 = t},
   
    query_col(N1).

qe :- evidence, query.
