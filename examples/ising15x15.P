:- import concat_atom/2 from string.

type(bool, [t, f]).
outcomes(edge, [bool, bool]).
set_sw(edge, [0.49, 0.01, 0.01, 0.49]).

row_edges(1,
	  N01,
	  N02,
	  N03,
	  N04,
	  N05,
	  N06,
	  N07,
	  N08,
	  N09,
	  N10,
	  N11,
	  N12,
	  N13,
	  N14,
	  N15) :-
    msw(edge, e_01_01_01_02, [N01, N02]),
    msw(edge, e_01_02_01_03, [N02S, N03]),
    msw(edge, e_01_03_01_04, [N03S, N04]),
    msw(edge, e_01_04_01_05, [N04S, N05]),
    msw(edge, e_01_05_01_06, [N05S, N06]),
    msw(edge, e_01_06_01_07, [N06S, N07]),
    msw(edge, e_01_07_01_08, [N07S, N08]),
    msw(edge, e_01_08_01_09, [N08S, N09]),
    msw(edge, e_01_09_01_10, [N09S, N10]),
    msw(edge, e_01_10_01_11, [N10S, N11]),
    msw(edge, e_01_11_01_12, [N11S, N12]),
    msw(edge, e_01_12_01_13, [N12S, N13]),
    msw(edge, e_01_13_01_14, [N13S, N14]),
    msw(edge, e_01_14_01_15, [N14S, N15]),
    {N02 = N02S},
    {N03 = N03S},
    {N04 = N04S},
    {N05 = N05S},
    {N06 = N06S},
    {N07 = N07S},
    {N08 = N08S},
    {N09 = N09S},
    {N10 = N10S},
    {N11 = N11S},
    {N12 = N12S},
    {N13 = N13S},
    {N14 = N14S}.

row_edges(Rin,
	  N01,
	  N02,
	  N03,
	  N04,
	  N05,
	  N06,
	  N07,
	  N08,
	  N09,
	  N10,
	  N11,
	  N12,
	  N13,
	  N14,
	  N15) :-

    1 < Rin, Rin =< 15,
    R1in is Rin - 1,

    column_edges(R1in, Rin,
		 M01,
		 M02,
		 M03,
		 M04,
		 M05,
		 M06,
		 M07,
		 M08,
		 M09,
		 M10,
		 M11,
		 M12,
		 M13,
		 M14,
		 M15),

    fmt_write_string(R, '%02d', Rin),
    concat_atom([e,'_',R,'_','01','_',R,'_','02'], E01),
    concat_atom([e,'_',R,'_','02','_',R,'_','03'], E02),    
    concat_atom([e,'_',R,'_','03','_',R,'_','04'], E03),    
    concat_atom([e,'_',R,'_','04','_',R,'_','05'], E04),    
    concat_atom([e,'_',R,'_','05','_',R,'_','06'], E05),
    concat_atom([e,'_',R,'_','06','_',R,'_','07'], E06),    
    concat_atom([e,'_',R,'_','07','_',R,'_','08'], E07),    
    concat_atom([e,'_',R,'_','08','_',R,'_','09'], E08),    
    concat_atom([e,'_',R,'_','09','_',R,'_','10'], E09),
    concat_atom([e,'_',R,'_','10','_',R,'_','11'], E10),    
    concat_atom([e,'_',R,'_','11','_',R,'_','12'], E11),    
    concat_atom([e,'_',R,'_','12','_',R,'_','13'], E12),    
    concat_atom([e,'_',R,'_','13','_',R,'_','14'], E13),    
    concat_atom([e,'_',R,'_','14','_',R,'_','15'], E14),    

    msw(edge, E01, [N01, N02]),
    msw(edge, E02, [N02S, N03]),
    msw(edge, E03, [N03S, N04]),
    msw(edge, E04, [N04S, N05]),
    msw(edge, E05, [N05S, N06]),
    msw(edge, E06, [N06S, N07]),
    msw(edge, E07, [N07S, N08]),
    msw(edge, E08, [N08S, N09]),
    msw(edge, E09, [N09S, N10]),
    msw(edge, E10, [N10S, N11]),
    msw(edge, E11, [N11S, N12]),
    msw(edge, E12, [N12S, N13]),
    msw(edge, E13, [N13S, N14]),
    msw(edge, E14, [N14S, N15]),

    {N02 = N02S},
    {N03 = N03S},
    {N04 = N04S},
    {N05 = N05S},
    {N06 = N06S},
    {N07 = N07S},
    {N08 = N08S},
    {N09 = N09S},
    {N10 = N10S},
    {N11 = N11S},
    {N12 = N12S},
    {N13 = N13S},
    {N14 = N14S},

    {M01 = N01},
    {M02 = N02},
    {M03 = N03},
    {M04 = N04},
    {M05 = N05},
    {M06 = N06},
    {M07 = N07},
    {M08 = N08},
    {M09 = N09},
    {M10 = N10},
    {M11 = N11},
    {M12 = N12},
    {M13 = N13},
    {M14 = N14},
    {M15 = N15}.

column_edges(R1in, R2in,
	     M01,
	     M02,
	     M03,
	     M04,
	     M05,
	     M06,
	     M07,
	     M08,
	     M09,
	     M10,
	     M11,
	     M12,
	     M13,
	     M14,
	     M15) :-

    row_edges(R1in,
	      N01,
	      N02,
	      N03,
	      N04,
	      N05,
	      N06,
	      N07,
	      N08,
	      N09,
	      N10,
	      N11,
	      N12,
	      N13,
	      N14,
	      N15),

    fmt_write_string(R1, '%02d', R1in),
    fmt_write_string(R2, '%02d', R2in),    
    concat_atom([e,'_',R1,'_','01','_',R2,'_','01'], E01),
    concat_atom([e,'_',R1,'_','02','_',R2,'_','02'], E02),
    concat_atom([e,'_',R1,'_','03','_',R2,'_','03'], E03),
    concat_atom([e,'_',R1,'_','04','_',R2,'_','04'], E04),
    concat_atom([e,'_',R1,'_','05','_',R2,'_','05'], E05),
    concat_atom([e,'_',R1,'_','06','_',R2,'_','06'], E06),
    concat_atom([e,'_',R1,'_','07','_',R2,'_','07'], E07),
    concat_atom([e,'_',R1,'_','08','_',R2,'_','08'], E08),
    concat_atom([e,'_',R1,'_','09','_',R2,'_','09'], E09),
    concat_atom([e,'_',R1,'_','10','_',R2,'_','10'], E10),
    concat_atom([e,'_',R1,'_','11','_',R2,'_','11'], E11),
    concat_atom([e,'_',R1,'_','12','_',R2,'_','12'], E12),
    concat_atom([e,'_',R1,'_','13','_',R2,'_','13'], E13),
    concat_atom([e,'_',R1,'_','14','_',R2,'_','14'], E14),
    concat_atom([e,'_',R1,'_','15','_',R2,'_','15'], E15),
    
    msw(edge, E01, [M01S, M01]),
    msw(edge, E02, [M02S, M02]),
    msw(edge, E03, [M03S, M03]),
    msw(edge, E04, [M04S, M04]),
    msw(edge, E05, [M05S, M05]),
    msw(edge, E06, [M06S, M06]),
    msw(edge, E07, [M07S, M07]),
    msw(edge, E08, [M08S, M08]),
    msw(edge, E09, [M09S, M09]),
    msw(edge, E10, [M10S, M10]),
    msw(edge, E11, [M11S, M11]),
    msw(edge, E12, [M12S, M12]),
    msw(edge, E13, [M13S, M13]),
    msw(edge, E14, [M14S, M14]),
    msw(edge, E15, [M15S, M15]),

    {M01S = N01},
    {M02S = N02},
    {M03S = N03},
    {M04S = N04},
    {M05S = N05},
    {M06S = N06},
    {M07S = N07},
    {M08S = N08},
    {M09S = N09},
    {M10S = N10},
    {M11S = N11},
    {M12S = N12},
    {M13S = N13},
    {M14S = N14},
    {M15S = N15}.    
    
    
evidence :-
    row_edges(15,
	      N01,
	      N02,
	      N03,
	      N04,
	      N05,
	      N06,
	      N07,
	      N08,
	      N09,
	      N10,
	      N11,
	      N12,
	      N13,
	      N14,
	      N15).

query :-
    query_row(15),
    query_col(15).

query_row(0).
query_row(Nin) :-
    Nin > 0,

    fmt_write_string(N, '%02d', Nin),    
    concat_atom([e,'_',N,'_','01','_',N,'_','02'], E01),
    concat_atom([e,'_',N,'_','02','_',N,'_','03'], E02),    
    concat_atom([e,'_',N,'_','03','_',N,'_','04'], E03),    
    concat_atom([e,'_',N,'_','04','_',N,'_','05'], E04),    
    concat_atom([e,'_',N,'_','05','_',N,'_','06'], E05),
    concat_atom([e,'_',N,'_','06','_',N,'_','07'], E06),    
    concat_atom([e,'_',N,'_','07','_',N,'_','08'], E07),    
    concat_atom([e,'_',N,'_','08','_',N,'_','09'], E08),    
    concat_atom([e,'_',N,'_','09','_',N,'_','10'], E09),
    concat_atom([e,'_',N,'_','10','_',N,'_','11'], E10),    
    concat_atom([e,'_',N,'_','11','_',N,'_','12'], E11),    
    concat_atom([e,'_',N,'_','12','_',N,'_','13'], E12),    
    concat_atom([e,'_',N,'_','13','_',N,'_','14'], E13),    
    concat_atom([e,'_',N,'_','14','_',N,'_','15'], E14),    

    msw(edge, E01, [N01, N02]),
    msw(edge, E02, [N02S, N03]),
    msw(edge, E03, [N03S, N04]),
    msw(edge, E04, [N04S, N05]),
    msw(edge, E05, [N05S, N06]),
    msw(edge, E06, [N06S, N07]),
    msw(edge, E07, [N07S, N08]),
    msw(edge, E08, [N08S, N09]),
    msw(edge, E09, [N09S, N10]),
    msw(edge, E10, [N10S, N11]),
    msw(edge, E11, [N11S, N12]),
    msw(edge, E12, [N12S, N13]),
    msw(edge, E13, [N13S, N14]),
    msw(edge, E14, [N14S, N15]),
    

    {N01 = t}, {N02 = t},
    {N02S = t}, {N03 = t},
    {N03S = t}, {N04 = t},
    {N04S = t}, {N05 = t},
    {N05S = t}, {N06 = t},
    {N06S = t}, {N07 = t},
    {N07S = t}, {N08 = t},
    {N08S = t}, {N09 = t},
    {N09S = t}, {N10 = t},
    {N10S = t}, {N11 = t},
    {N11S = t}, {N12 = t},
    {N12S = t}, {N13 = t},
    {N13S = t}, {N14 = t},
    {N14S = t}, {N15 = t},

    N1in is Nin-1,
    query_row(N1in).

query_col(1).
query_col(N2in) :-
    N2in > 1,
    N1in is N2in - 1,

    fmt_write_string(N1, '%02d', N1in),
    fmt_write_string(N2, '%02d', N2in),
    concat_atom([e,'_',N1,'_','01','_',N2,'_','01'], E01),
    concat_atom([e,'_',N1,'_','02','_',N2,'_','02'], E02),
    concat_atom([e,'_',N1,'_','03','_',N2,'_','03'], E03),
    concat_atom([e,'_',N1,'_','04','_',N2,'_','04'], E04),
    concat_atom([e,'_',N1,'_','05','_',N2,'_','05'], E05),
    concat_atom([e,'_',N1,'_','06','_',N2,'_','06'], E06),
    concat_atom([e,'_',N1,'_','07','_',N2,'_','07'], E07),
    concat_atom([e,'_',N1,'_','08','_',N2,'_','08'], E08),
    concat_atom([e,'_',N1,'_','09','_',N2,'_','09'], E09),
    concat_atom([e,'_',N1,'_','10','_',N2,'_','10'], E10),
    concat_atom([e,'_',N1,'_','11','_',N2,'_','11'], E11),
    concat_atom([e,'_',N1,'_','12','_',N2,'_','12'], E12),
    concat_atom([e,'_',N1,'_','13','_',N2,'_','13'], E13),
    concat_atom([e,'_',N1,'_','14','_',N2,'_','14'], E14),
    concat_atom([e,'_',N1,'_','15','_',N2,'_','15'], E15),
    
    msw(edge, E01, [M01S, M01]),
    msw(edge, E02, [M02S, M02]),
    msw(edge, E03, [M03S, M03]),
    msw(edge, E04, [M04S, M04]),
    msw(edge, E05, [M05S, M05]),
    msw(edge, E06, [M06S, M06]),
    msw(edge, E07, [M07S, M07]),
    msw(edge, E08, [M08S, M08]),
    msw(edge, E09, [M09S, M09]),
    msw(edge, E10, [M10S, M10]),
    msw(edge, E11, [M11S, M11]),
    msw(edge, E12, [M12S, M12]),
    msw(edge, E13, [M13S, M13]),
    msw(edge, E14, [M14S, M14]),
    msw(edge, E15, [M15S, M15]),

    {M01S = t}, {M01 = t},
    {M02S = t}, {M02 = t},
    {M03S = t}, {M03 = t},
    {M04S = t}, {M04 = t},
    {M05S = t}, {M05 = t},
    {M06S = t}, {M06 = t},
    {M07S = t}, {M07 = t},
    {M08S = t}, {M08 = t},
    {M09S = t}, {M09 = t},
    {M10S = t}, {M10 = t},
    {M11S = t}, {M11 = t},
    {M12S = t}, {M12 = t},
    {M13S = t}, {M13 = t},
    {M14S = t}, {M14 = t},
    {M15S = t}, {M15 = t},
   
    query_col(N1in).
